<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Exercises | MixR: Mixed Models in R</title>
  <meta name="description" content="Exercises | MixR: Mixed Models in R" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Exercises | MixR: Mixed Models in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Exercises | MixR: Mixed Models in R" />
  
  
  

<meta name="author" content="Ben Whalley" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="repeated-measures.html"/>
<link rel="next" href="mixed-models.html"/>
<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="media/webex.css" rel="stylesheet" />
<link href="media/psystats.css" rel="stylesheet" />
<script src="media/webex.js"></script>
<script src="media/psystats.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118343766-4"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-118343766-4');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MixR</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="" data-path="repeated-measures.html"><a href="repeated-measures.html"><i class="fa fa-check"></i>Repeated measures</a>
<ul>
<li class="chapter" data-level="" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html"><i class="fa fa-check"></i>Mixed models</a>
<ul>
<li class="chapter" data-level="" data-path="piglets-random-slope.html"><a href="piglets-random-slope.html"><i class="fa fa-check"></i>Piglets (random intercepts)</a></li>
<li><a href="r2-for-mixed-models.html#r2-for-mixed-models"><span class="math inline">\(R^2\)</span> for mixed models</a></li>
<li class="chapter" data-level="" data-path="random-slopes.html"><a href="random-slopes.html"><i class="fa fa-check"></i>Random slopes</a></li>
<li class="chapter" data-level="" data-path="likelihood-ratio-tests.html"><a href="likelihood-ratio-tests.html"><i class="fa fa-check"></i>Likelihood ratio tests</a></li>
<li class="chapter" data-level="" data-path="school-leavers-longer-exercise.html"><a href="school-leavers-longer-exercise.html"><i class="fa fa-check"></i>Scottish school leavers data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="random-effects.html"><a href="random-effects.html"><i class="fa fa-check"></i>Random effects</a>
<ul>
<li class="chapter" data-level="" data-path="sleep-centering.html"><a href="sleep-centering.html"><i class="fa fa-check"></i>Sleep (centering)</a></li>
<li class="chapter" data-level="" data-path="mma.html"><a href="mma.html"><i class="fa fa-check"></i>MMA</a></li>
<li class="chapter" data-level="" data-path="politeness.html"><a href="politeness.html"><i class="fa fa-check"></i>Politeness</a></li>
<li class="chapter" data-level="" data-path="model-complexity.html"><a href="model-complexity.html"><i class="fa fa-check"></i>Model complexity</a></li>
<li class="chapter" data-level="" data-path="extensions.html"><a href="extensions.html"><i class="fa fa-check"></i>Extensions</a></li>
<li class="chapter" data-level="" data-path="further-reading.html"><a href="further-reading.html"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="assessment.html"><a href="assessment.html"><i class="fa fa-check"></i>Assessment</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank">Licence: CC BY-SA 4</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MixR: Mixed Models in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercises" class="section level2">
<h2>Exercises</h2>
<!-- A worked example
To put some numbers to the claim above:

Imagine we were studying a medium effect size (D=.5), in a situation where 15% of the variance in outcomes was explained by the school a child attended.

We want to achieve power of 80% for alpha = .05.

In this case, increasing the number of schools sampled from 20 to 21 would reduce the total N (total number of students) from 111 students to 105.

That is, we sample fewer students, but gain statistical power.
 -->
<div id="scottish-school-leavers" class="section level3">
<h3>Scottish School Leavers</h3>
<blockquote>
<p><a href="data/cmm/5.1.txt">5.1.txt</a> contains data from the Scottish School Leavers Survey (SSLS), a nationally representative survey of young people. The file has data from seven cohorts of young people collected in the first sweep of the study, carried out at the end of the final year of compulsory schooling (aged 16-17) when most sample members had taken Standard grades.</p>
</blockquote>
<p>These data form part of the Bristol CMM multilevel modelling course, which is free to students in the UK at <a href="https://www.cmm.bris.ac.uk/lemma/" class="uri">https://www.cmm.bris.ac.uk/lemma/</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="exercises.html#cb1-1"></a>schools &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;data/cmm/5.1.txt&#39;</span>)</span>
<span id="cb1-2"><a href="exercises.html#cb1-2"></a>schools <span class="op">%&gt;%</span><span class="st"> </span>skimr<span class="op">::</span><span class="kw">skim</span>()</span></code></pre></div>
<table>
<caption><span id="tab:readssldata">Table 1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">33988</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">9</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">9</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">caseid</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">18465.74</td>
<td align="right">11435.16</td>
<td align="right">1</td>
<td align="right">8531.75</td>
<td align="right">17318.5</td>
<td align="right">29428.25</td>
<td align="right">38192</td>
<td align="left">▇▇▇▅▇</td>
</tr>
<tr class="even">
<td align="left">schoolid</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">254.36</td>
<td align="right">149.76</td>
<td align="right">1</td>
<td align="right">123.00</td>
<td align="right">256.0</td>
<td align="right">386.00</td>
<td align="right">511</td>
<td align="left">▇▇▇▇▇</td>
</tr>
<tr class="odd">
<td align="left">score</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">31.09</td>
<td align="right">17.31</td>
<td align="right">0</td>
<td align="right">19.00</td>
<td align="right">33.0</td>
<td align="right">45.00</td>
<td align="right">75</td>
<td align="left">▅▆▇▅▁</td>
</tr>
<tr class="even">
<td align="left">cohort90</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.28</td>
<td align="right">5.35</td>
<td align="right">-6</td>
<td align="right">-4.00</td>
<td align="right">-2.0</td>
<td align="right">6.00</td>
<td align="right">8</td>
<td align="left">▇▃▃▁▇</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.53</td>
<td align="right">0.50</td>
<td align="right">0</td>
<td align="right">0.00</td>
<td align="right">1.0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▇</td>
</tr>
<tr class="even">
<td align="left">sclass</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.15</td>
<td align="right">0.99</td>
<td align="right">1</td>
<td align="right">1.00</td>
<td align="right">2.0</td>
<td align="right">3.00</td>
<td align="right">4</td>
<td align="left">▇▇▁▇▂</td>
</tr>
<tr class="odd">
<td align="left">schtype</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.05</td>
<td align="right">0.21</td>
<td align="right">0</td>
<td align="right">0.00</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">schurban</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.71</td>
<td align="right">0.45</td>
<td align="right">0</td>
<td align="right">0.00</td>
<td align="right">1.0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="left">▃▁▁▁▇</td>
</tr>
<tr class="odd">
<td align="left">schdenom</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.16</td>
<td align="right">0.36</td>
<td align="right">0</td>
<td align="right">0.00</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▂</td>
</tr>
</tbody>
</table>
<div class="exercise">
<ul>
<li><p>Read in the scottish school leaver data (<a href="data/cmm/5.1.txt">this file</a>)</p></li>
<li><p>Use ggplot to visualise how much variation in <code>score</code> there is within and between schools. You might need to subset the data to avoid being overwhelmed.</p></li>
</ul>
<div class="solution">
<button class="solution-button">
Hints
</button>
<p>One option would be a boxplot where <code>schoolid</code> is the x axis. Another would be to use <code>stat_summary</code> which would show the mean and SE for each school.</p>
</div>
<ul>
<li><p>Use <code>group_by</code> and <code>summarize</code> to calculate the mean and variance of <code>score</code> within each of the schools, and the sample size in each school (you can use <code>n = length(score)</code> to count the number of observations within each school).</p></li>
<li><p>Plot the mean of each school (y axis) against the <span class="math inline">\(1/var\)</span> of the school (x axis).</p></li>
<li><p>Think about which observations you ‘trust’ most? Why?</p></li>
</ul>
<div class="solution">
<button class="solution-button">
What is 1/var?
</button>
<p>Taking <span class="math inline">\(1/var\)</span> is often called the ‘inverse variance’ of a measurement. The larger <span class="math inline">\(1/var\)</span> is, the more confidence we have in the measurement.</p>
<p>If we want to take the average of all schools, then we might ‘weight’ measurements by their precision.</p>
<p>This is, in fact, how meta analysis works: smaller studies are down-weighted in proportion to their precision, not just their sample size. The weighted average in a meta analysis could be calculated as where <span class="math inline">\(y_i\)</span> is the outcome in a particular study, <span class="math inline">\(i\)</span>.</p>
<p><span class="math inline">\(\hat{y} = \frac{\sum_i y_i / \sigma_i^2}{\sum_i 1/\sigma_i^2}\)</span></p>
</div>
<div class="solution">
<button class="solution-button">
What pattern should I notice?!
</button>
<p>If you make a plot as suggested (below) you can see that, looking at the high precision schools (those on the right of the plot), there are more above the mean than below (dotted line). These are still smaller-school (or, fewer students sampled in these schools) but if we ‘trust’ lower-variance estimates more, then we might want to allow for that when we estimate the mean of all schools.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="exercises.html#cb2-1"></a>schools.agg &lt;-<span class="st"> </span>schools <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(schoolid) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">score.m=</span><span class="kw">mean</span>(score), <span class="dt">var=</span><span class="kw">var</span>(score), <span class="dt">n=</span><span class="kw">length</span>(score))</span>
<span id="cb2-2"><a href="exercises.html#cb2-2"></a>schools.agg <span class="op">%&gt;%</span></span>
<span id="cb2-3"><a href="exercises.html#cb2-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dv">1</span><span class="op">/</span>var, score.m, <span class="dt">size=</span>n)) <span class="op">+</span></span>
<span id="cb2-4"><a href="exercises.html#cb2-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span>.<span class="dv">25</span>) <span class="op">+</span></span>
<span id="cb2-5"><a href="exercises.html#cb2-5"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="kw">mean</span>(schools<span class="op">$</span>score), <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb2-6"><a href="exercises.html#cb2-6"></a><span class="op">&gt;</span><span class="st"> </span>Warning<span class="op">:</span><span class="st"> </span>Removed <span class="dv">8</span> rows containing missing <span class="kw">values</span> (geom_point).</span></code></pre></div>
<p><img src="01-repeat-measures_files/figure-html/precisionplot-1.png" width="672" /></p>
<p>Precision-weighting (and mixed models) work on the principle that we want to use information about how precisely each schools’ mean is estimated to inform our overall estimate.</p>
</div>
</div>
<div id="variance-weighting-using-mixed-models" class="section level4">
<h4>Variance-weighting using mixed models</h4>
<p>Mixed models are another way to include information about variability when estimating the overall mean.</p>
<p>Before we do this, let’s calculate the mean of <code>score</code> in the sample as a reference to compare against:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="exercises.html#cb3-1"></a><span class="kw">mean</span>(schools<span class="op">$</span>score)</span>
<span id="cb3-2"><a href="exercises.html#cb3-2"></a><span class="op">&gt;</span><span class="st"> </span>[<span class="dv">1</span>] <span class="fl">31.09462</span></span></code></pre></div>
<p>We could equally have calculated the mean of all schools using <code>lm</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="exercises.html#cb4-1"></a>(m.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data=</span>schools))</span>
<span id="cb4-2"><a href="exercises.html#cb4-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb4-3"><a href="exercises.html#cb4-3"></a><span class="er">&gt;</span><span class="st"> </span>Call<span class="op">:</span></span>
<span id="cb4-4"><a href="exercises.html#cb4-4"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> score <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> schools)</span>
<span id="cb4-5"><a href="exercises.html#cb4-5"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb4-6"><a href="exercises.html#cb4-6"></a><span class="er">&gt;</span><span class="st"> </span>Coefficients<span class="op">:</span></span>
<span id="cb4-7"><a href="exercises.html#cb4-7"></a><span class="er">&gt;</span><span class="st"> </span>(Intercept)  </span>
<span id="cb4-8"><a href="exercises.html#cb4-8"></a><span class="op">&gt;</span><span class="st">       </span><span class="fl">31.09</span></span></code></pre></div>
<p>In this model the formula is <code>score ~ 1</code>. The <code>1</code> represents an intercept, so the model is estimating the <em>average</em> value across all schools with no other predictors. This is not a weighted average though: we are ignoring the information about which school an observation came from.</p>
<hr />
<p>To calculate something more like a precision-weighted estimate—that is, one which takes into account how much variability there was <em>within</em> each school to calculate the average of all schools — we can use a <em>mixed</em> model. In R we use the <code>lmer</code> function (in place of <code>lm</code>):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="exercises.html#cb5-1"></a><span class="kw">library</span>(lmerTest)</span>
<span id="cb5-2"><a href="exercises.html#cb5-2"></a>(m.lmer &lt;-<span class="st"> </span><span class="kw">lmer</span>( score <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>schoolid), <span class="dt">data =</span> schools))</span>
<span id="cb5-3"><a href="exercises.html#cb5-3"></a><span class="op">&gt;</span><span class="st"> </span>Linear mixed model fit by REML [<span class="st">&#39;lmerModLmerTest&#39;</span>]</span>
<span id="cb5-4"><a href="exercises.html#cb5-4"></a><span class="op">&gt;</span><span class="st"> </span>Formula<span class="op">:</span><span class="st"> </span>score <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>schoolid)</span>
<span id="cb5-5"><a href="exercises.html#cb5-5"></a><span class="op">&gt;</span><span class="st">    </span>Data<span class="op">:</span><span class="st"> </span>schools</span>
<span id="cb5-6"><a href="exercises.html#cb5-6"></a><span class="op">&gt;</span><span class="st"> </span>REML criterion at convergence<span class="op">:</span><span class="st"> </span><span class="fl">286539.2</span></span>
<span id="cb5-7"><a href="exercises.html#cb5-7"></a><span class="op">&gt;</span><span class="st"> </span>Random effects<span class="op">:</span></span>
<span id="cb5-8"><a href="exercises.html#cb5-8"></a><span class="er">&gt;</span><span class="st">  </span>Groups   Name        Std.Dev.</span>
<span id="cb5-9"><a href="exercises.html#cb5-9"></a><span class="op">&gt;</span><span class="st">  </span><span class="kw">schoolid</span> (Intercept)  <span class="fl">7.821</span>  </span>
<span id="cb5-10"><a href="exercises.html#cb5-10"></a><span class="op">&gt;</span><span class="st">  </span>Residual             <span class="fl">16.073</span>  </span>
<span id="cb5-11"><a href="exercises.html#cb5-11"></a><span class="op">&gt;</span><span class="st"> </span>Number of obs<span class="op">:</span><span class="st"> </span><span class="dv">33988</span>, groups<span class="op">:</span><span class="st">  </span>schoolid, <span class="dv">508</span></span>
<span id="cb5-12"><a href="exercises.html#cb5-12"></a><span class="op">&gt;</span><span class="st"> </span>Fixed Effects<span class="op">:</span></span>
<span id="cb5-13"><a href="exercises.html#cb5-13"></a><span class="er">&gt;</span><span class="st"> </span>(Intercept)  </span>
<span id="cb5-14"><a href="exercises.html#cb5-14"></a><span class="op">&gt;</span><span class="st">        </span><span class="fl">30.6</span></span></code></pre></div>
<p>The output here has extra information compared to <code>lm</code>. However like <code>lm</code> the coefficients from the model are listed, which <code>lmer</code> calls ‘fixed effects’.</p>
<p>In this case we only have an intercept, which we can compare with the lm output.</p>
<ul>
<li>What is the difference between the weighted and unweighted average for all schools to 2 d.p.? <span id="Q702894" class="webex-fitb"><input class='solveme  nospaces calculator' data-tol=0.05 data-digits=4 size=4  style='width:4em;'  data-answer='["0.49",".49"]'/><span class="solvedme"></span></span></li>
</ul>
<div class="solution">
<button class="solution-button">
Show answer
</button>
<p>The difference is 0.49.</p>
</div>
<hr />
<p>One way to think about what is happening here is to compare the average for individual schools with the adjusted predictions made by the model.</p>
<p>The function <code>ranef(m.lmer)</code> gives us a list of the estimated (weighted) averages for each school from the <code>lmer</code> model.</p>
<p>We can make a plot which shows how much the weighted averages ‘shrink’ towards the overall mean. In the plot below:</p>
<ul>
<li>the blue dashes are the <em>adjusted</em> estimates for each of 100 schools</li>
<li>the grey bubbles are the unweighted averages of those schools</li>
<li>the size of the grey bubbles represents the number of students sampled at that school</li>
<li>the blue and red lines are the weighted/unweighted average of all schools</li>
</ul>
<p><img src="01-repeat-measures_files/figure-html/shrinkageplot-1.png" width="672" /></p>
<div class="exercise">
<ul>
<li><p>Examine the plot above. Which schools ‘shrink’ most? That is, which have the biggest difference between unweighted and weighted values? Does the pattern make sense to you?</p></li>
<li><p>How do you feel about the size of the change (i.e. difference between red and blue lines)? Should we care?</p></li>
</ul>
<div class="solution">
<button class="solution-button">
Show discussion
</button>
<p>The schools that are i) furthest from the mean and/or ii) smallest in size shrink most. This makes sense because these are the schools that we are least confident about.</p>
<p>The red line might not seem that different, but remember that the range of the y axis has to be large to show all the inter-school variation. A change in 0.5 points on this scale might well be important, and in limited-power settings (i.e. small psychological experiments) could also result in a change to the inference we make.</p>
</div>
</div>
</div>
<div id="random-intercepts" class="section level4">
<h4>‘Random’ intercepts</h4>
<p>In the model above, we told <code>lmer</code> that <code>schoolid</code> was a grouping variable in our data. The formula was:</p>
<pre><code>y ~ 1 + (1|grouping)</code></pre>
<p>You can see from this formula there are actually two types of intercept in the model.</p>
<ul>
<li>The first <code>1</code> indicates we should fit the intercept representing the mean of all schools</li>
<li>The second <code>1</code>, in the <code>(1|grouping)</code> part of the formula tells lmer to fit a <em>random intercept</em>.</li>
</ul>
<p>By random intercept, we actually mean <em>fit an intercept (mean) for each school</em> individually. This means the model is like the one shown in the lecture slides:</p>
<p><img src="images/variance-components-3-sumssquareswithinandbetween.png" /></p>
<p>The coloured lines in this plot are the random intercepts, and the dotted line is the overall intercept (average of all schools).</p>
<div class="exercise">
<p>Look at the area covered by the grey squares, and the coloured squares, in the plot below.</p>
<p>Can you identify which numbers in the <code>lmer</code> output would refer to the size of each set of squares?</p>
<ul>
<li>Grey squares: <span id="Q32977" class="webex-fitb"><input class='solveme  nospaces calculator' data-tol=1 data-digits=4 size=16  style='width:16em;'  data-answer='["61.1733465921979"]'/><span class="solvedme"></span></span></li>
<li>Coloured squares: <span id="Q775351" class="webex-fitb"><input class='solveme  nospaces calculator' data-tol=1 data-digits=4 size=16  style='width:16em;'  data-answer='["258.356553464285"]'/><span class="solvedme"></span></span></li>
</ul>
<div class="solution">
<button class="solution-button">
Show hint
</button>
<p>The grey squares relate to the <code>schoolid</code> term in the ‘Random effects’ section. The coloured squares are the <code>Residual</code>.</p>
</div>
<div class="solution">
<button class="solution-button">
Show answers
</button>
<table style="width:42%;">
<colgroup>
<col width="15%" />
<col width="11%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">grp</th>
<th align="center">vcov</th>
<th align="center">squares</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">schoolid</td>
<td align="center">61.17</td>
<td align="center">Grey</td>
</tr>
<tr class="even">
<td align="center">Residual</td>
<td align="center">258.4</td>
<td align="center">Coloured</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="summary" class="section level4">
<h4>Summary</h4>
<ul>
<li>A simple average ignores how much variation there was within schools.</li>
<li>The inverse of the variance is a measure of <em>precision</em>.</li>
<li>Adjusting our estimate for sample size and precision can change our estimate of the overall mean</li>
<li>Uncertain values are ‘shrunk’ towards the overall mean. That is: if a school has lots of variability, and a mean which is far from the overall average, we shrink our estimate for that school to account for the uncertainty.</li>
</ul>
<p>To do this in R:</p>
<ul>
<li>use <code>lmer</code> not <code>lm</code></li>
<li>include the grouping variable at the end of the formula (i.e. <code>(1|grouping)</code>)</li>
<li>the <code>lmer</code> model splits the total variance within and between schools (as we did in the example plots)</li>
</ul>
<div class="exercise">
<ul>
<li>Can you think of examples in experimental settings where ‘shrinkage’ might be useful? Discuss why this might be the case.</li>
</ul>
<div class="solution">
<button class="solution-button">
Show an example
</button>
<p>One example would be in experiments where participants make many responses, e.g. in a computer-based task. If a participant is very variable in their responding then we might be less-certain about our estimate of their mean response.</p>
<p>Traditionally experimenters might deal with variable responding by excluding participants or data. But this can be arbitrary (where do we set the threshold?) and also doesn’t deal fully with the imprecision. For example, we might exclude responses were an RT is &gt; 3000ms, but this would still allow some participants to be much more variable than others.</p>
<p>‘Shrinking’ variable-responders towards the overall mean is a more principled way of dealing with this lack of precision.
It avoids arbitrary cutoffs, can and might increase power when some participants have responded eratically or didn’t fully engage with the task. It also enables us to explore variability within and between participants directly, as we’ll see later.</p>
</div>
</div>
</div>
</div>
<div id="variance-components" class="section level3">
<h3>Variance components</h3>
<p>We will cover this in more detail later, but it’s worth also looking at another part of the <code>lmer</code> output. This time we pass the saved model to the <code>summary</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="exercises.html#cb7-1"></a>m.lmer <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>()</span>
<span id="cb7-2"><a href="exercises.html#cb7-2"></a><span class="op">&gt;</span><span class="st"> </span>Linear mixed model fit by REML. t<span class="op">-</span>tests use Satterthwaite<span class="st">&#39;s method [</span></span>
<span id="cb7-3"><a href="exercises.html#cb7-3"></a><span class="st">&gt; lmerModLmerTest]</span></span>
<span id="cb7-4"><a href="exercises.html#cb7-4"></a><span class="st">&gt; Formula: score ~ 1 + (1 | schoolid)</span></span>
<span id="cb7-5"><a href="exercises.html#cb7-5"></a><span class="st">&gt;    Data: schools</span></span>
<span id="cb7-6"><a href="exercises.html#cb7-6"></a><span class="st">&gt; </span></span>
<span id="cb7-7"><a href="exercises.html#cb7-7"></a><span class="st">&gt; REML criterion at convergence: 286539.2</span></span>
<span id="cb7-8"><a href="exercises.html#cb7-8"></a><span class="st">&gt; </span></span>
<span id="cb7-9"><a href="exercises.html#cb7-9"></a><span class="st">&gt; Scaled residuals: </span></span>
<span id="cb7-10"><a href="exercises.html#cb7-10"></a><span class="st">&gt;     Min      1Q  Median      3Q     Max </span></span>
<span id="cb7-11"><a href="exercises.html#cb7-11"></a><span class="st">&gt; -2.9764 -0.7011  0.1017  0.7391  3.0819 </span></span>
<span id="cb7-12"><a href="exercises.html#cb7-12"></a><span class="st">&gt; </span></span>
<span id="cb7-13"><a href="exercises.html#cb7-13"></a><span class="st">&gt; Random effects:</span></span>
<span id="cb7-14"><a href="exercises.html#cb7-14"></a><span class="st">&gt;  Groups   Name        Variance Std.Dev.</span></span>
<span id="cb7-15"><a href="exercises.html#cb7-15"></a><span class="st">&gt;  schoolid (Intercept)  61.17    7.821  </span></span>
<span id="cb7-16"><a href="exercises.html#cb7-16"></a><span class="st">&gt;  Residual             258.36   16.073  </span></span>
<span id="cb7-17"><a href="exercises.html#cb7-17"></a><span class="st">&gt; Number of obs: 33988, groups:  schoolid, 508</span></span>
<span id="cb7-18"><a href="exercises.html#cb7-18"></a><span class="st">&gt; </span></span>
<span id="cb7-19"><a href="exercises.html#cb7-19"></a><span class="st">&gt; Fixed effects:</span></span>
<span id="cb7-20"><a href="exercises.html#cb7-20"></a><span class="st">&gt;             Estimate Std. Error       df t value Pr(&gt;|t|)    </span></span>
<span id="cb7-21"><a href="exercises.html#cb7-21"></a><span class="st">&gt; (Intercept)  30.6006     0.3698 450.7146   82.74   &lt;2e-16 ***</span></span>
<span id="cb7-22"><a href="exercises.html#cb7-22"></a><span class="st">&gt; ---</span></span>
<span id="cb7-23"><a href="exercises.html#cb7-23"></a><span class="st">&gt; Signif. codes:  0 &#39;</span><span class="op">**</span><span class="er">*</span><span class="st">&#39; 0.001 &#39;</span><span class="op">**</span><span class="st">&#39; 0.01 &#39;</span><span class="op">*</span><span class="st">&#39; 0.05 &#39;</span>.<span class="st">&#39; 0.1 &#39;</span> <span class="st">&#39; 1</span></span></code></pre></div>
<p>In the output above we can see a section called ‘Random effects’. By ‘random’, <code>lmer</code> is referring to estimates of variance not that the results are random! As an aside, the ‘mixed’ in the name mixed models refers to the mix of ‘fixed’ and ‘random’ effects. We’ll discuss these terms more later on.</p>
<p>We can see the there are two lines in this table, marked:</p>
<ul>
<li><code>schoolid (intercept)</code></li>
<li><code>Residual</code></li>
</ul>
<p>If we add the <code>Variance</code> values together we get 320. This is, the total variance in the <code>score</code> outcome.</p>
<p>However, because we have the variance split into two numbers we can calculate the <em>proportion</em> of total variance explained by differences between schools (what is left over is explained by variation between children).</p>
<p><span class="math inline">\(var_{j} = \frac{between}{total}\)</span></p>
<div class="exercise">
<p>Run <code>summary</code> on the saved lmer model and calculate the proportion of variance which is between schools, and how much is within schools.</p>
<div class="solution">
<button class="solution-button">
Show answer
</button>
<p>61.2 / 319.6 * 100 = 19%</p>
</div>
</div>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="repeated-measures.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mixed-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
